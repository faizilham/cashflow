{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block heads %}
	
	<link rel="stylesheet" href="static/css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="static/css/bootstrap-select.min.css" type="text/css" />
	<link rel="stylesheet" href="static/css/bootstrap-datetimepicker.min.css" type="text/css" />
	<link rel="stylesheet" href="static/css/style.css" type="text/css" />

	<script type="text/javascript" src="static/js/jquery.min.js"></script>
	<script type="text/javascript" src="static/js/moment.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap-datetimepicker.min.js"></script>

	<script type="text/javascript">
		var accounts = {}

		{% for account in accounts %}
		accounts["{{ account['name'] }}"] = {
			"fund": {{ account["fund"] }},
			"current": {{ account["current"] }}
		};
		{% endfor %}
	</script>
{% endblock %}

{% block footscript %}
	<script type="text/javascript" src="static/js/main.js"></script>
	<script type="text/javascript">

		$(".datepick").datetimepicker({
			"viewMode": "days",
			'format': 'YYYY-MM-DD',
			"defaultDate": new Date()
		});


		$("#flowinput").on("changed.bs.select", changeFlowChoice);
		$(".numinput").keypress(validateNumberTextbox);

		changeFlowChoice();
		scrollCashflow($('.entry').last());
	</script>
{% endblock %}
{% block content %}
	<h3 class="center">Cashflow</h3>
	<table class="entrytable">
		<thead>
			<tr class="theader">
				<th class="col1">Date</th>
				<th class="col1">Account</th>
				<th class="col1">Type</th>
				<th class="col2">Category</th>
				<th class="col3">Amount</th>
				<th class="col4">Details</th>
				<th class="col5"></th>
			</tr>
		</thead>

		<tbody class="cashflow">
			{% include "render_cashflow.html" %}
			<tr id="tranchor" class="hidden"></tr>
		</tbody>
	</table>

	<table class="actionbar">

		<tr id="trchoose">
			<td>
				 <div class="dropdown">
					<button id="actionchoose" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"><span class="caret"></span></button>
					<ul class="dropdown-menu dropdown-menu-right">
						<li><a href="#" onclick="chooseAction('insert')"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Insert</a></li>
						<li><a href="#" onclick="chooseAction('transfer')"><span class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Transfer</a></li>
					</ul>
				</div>
			</td>
		</tr>

		<tr id="trinsert" class="traction">
		<fieldset id="entryForm">
		<form onsubmit="return submitInsert()">
			<td class="tdaction col1">
				<div class='input-group date'>
					<input class="form-control datepick" id="dateinput" name="date" autocomplete="off"/>
					<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
					</span>
				</div>
				
			</td>
			<td class="col1">
				<select id="accountinput" name="account" class="selectpicker form-control">
					{% for account in accounts %}
					<option value="{{account['name']}}">{{account['name']}}</option>
					{% endfor %}
				</select>
			</td>
			<td class="col1">
				<select id="flowinput" name="flow" class="selectpicker form-control">
					<option value="1">Credit</option>
					<option value="-1" selected>Debit</option>
				</select>
			</td>
			<td class="col2">
				<select id="categoryinput" class="selectpicker dropup form-control" data-dropup-auto="false" data-live-search="true" title="Select category" data-size="10" name="category">
					<option id="emptyselect" value="" data-hidden="true" disabled selected></option>
					{% for category in categories %}
					<option id="category{{category['id']}}" value="{{category['id']}}" data-flowtype="{{category['flow']}}" data-tokens="{{category['name']}} {{category['group']}}" {{"disabled" if category['flow'] > 0 else ""}} >[{{category['group']}}] {{category['name']}}</option>
					{% endfor %}
				</select>
			</td>
			<td class="col3">
				<input class="form-control numinput" id="amountinput" name="amount" autocomplete="off" placeholder="Amount"/>
			</td>
			<td class="col4">
				<input class="form-control detinput" id="detailsinput" name="details" placeholder="Details"/>
			</td>
			<td class="actiontd col5">
				<button class="btn btn-default" type="submit" title="Insert New Transaction"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
			</td>
		</form>
		</fieldset>
		</tr>

		<tr id="trtransfer" class="traction hidden">
		<fieldset id="transferForm">
		<form onsubmit="return submitTransfer()">
			<td class="col1">
				<div class='input-group date'>
					<input class="form-control datepick" id="date-transfer" name="date-transfer" autocomplete="off"/>
					<span class="input-group-addon">
						<span class="glyphicon glyphicon-calendar"></span>
					</span>
				</div>
			</td>

			<td colspan="2" class="col1a">
				<select id="account-from-transfer" name="account-from" class="selectpicker form-control">
					{% for account in accounts %}
					<option value="{{account['name']}}">From: {{account['name']}}</option>
					{% endfor %}
				</select>				
			</td>
			
			<td class="col2">
				<select id="account-to-transfer" name="account-to" class="selectpicker form-control">
					{% for account in accounts %}
					<option value="{{account['name']}}">To: {{account['name']}}</option>
					{% endfor %}
				</select>
			</td>
			<td class="col3">
				<input class="form-control numinput" id="amount-transfer" name="amount-transfer" autocomplete="off" placeholder="Amount"/>
			</td>
			<td class="col4">
				<input class="form-control detinput" id="details-transfer" name="details-transfer" placeholder="Details"/>
			</td>
			<td class="actiontd col5">
				<button class="btn btn-default" type="submit" title="Transfer"><span class="glyphicon glyphicon-transfer" aria-hidden="true"></span></button>
			</td>
		</form>
		</fieldset>
		</tr>		
	</table>

	<hr/>

	<div>
		<button class="btn btn-info" data-toggle="modal" data-target="#summary-modal">Summary</button>
	</div>
	
	<div class="modal" id="summary-modal" role="dialog">
		<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Summary</h4>
			</div>
			<div class="modal-body">
				<table class="summary">
					<tr>
						<td></td>
						<td>Total</td>
						<td>This Month</td>
					</tr>
					{% for account in accounts %}
					<tr>
						<td>{{ account["name"]}}</td>
						<td id="{{ account['name']}}-total">{{ format_money(account["fund"]) }}</td>
						<td id="{{ account['name']}}-monthly" {% if account["current"] < 0 %} class="debit" {% endif %}>{{ format_money(account["current"]) }}</td>
						
					</tr>
					{% endfor %}

				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
		</div>
	</div>
{% endblock %}